{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar Mutex = /** @class */function () {\n  function Mutex() {\n    this._queue = [];\n    this._pending = false;\n  }\n  Mutex.prototype.isLocked = function () {\n    return this._pending;\n  };\n  Mutex.prototype.acquire = function () {\n    var _this = this;\n    var ticket = new Promise(function (resolve) {\n      return _this._queue.push(resolve);\n    });\n    if (!this._pending) {\n      this._dispatchNext();\n    }\n    return ticket;\n  };\n  Mutex.prototype.runExclusive = function (callback) {\n    return this.acquire().then(function (release) {\n      var result;\n      try {\n        result = callback();\n      } catch (e) {\n        release();\n        throw e;\n      }\n      return Promise.resolve(result).then(function (x) {\n        return release(), x;\n      }, function (e) {\n        release();\n        throw e;\n      });\n    });\n  };\n  Mutex.prototype._dispatchNext = function () {\n    if (this._queue.length > 0) {\n      this._pending = true;\n      this._queue.shift()(this._dispatchNext.bind(this));\n    } else {\n      this._pending = false;\n    }\n  };\n  return Mutex;\n}();\nexports.default = Mutex;","map":null,"metadata":{},"sourceType":"script"}